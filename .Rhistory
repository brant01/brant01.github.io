select(plr_team, Salary, Position, points:risk)
data_analysis <- data %>%
group_by(plr_team) %>%
mutate(Num = n()) %>%
ungroup() %>%
filter(Num > 1)
#Lineup
# 1 QB, 2 RB, 3 WR, TE, FLEX, DST
qb_bf <- data %>%
filter(Position == "QB")
rb_bf <- data %>%
filter(Position == "RB")
wr_bf <- data %>%
filter(Position == "WR")
te_bf <- data %>%
filter(Position == "TE")
flex_bf <- data %>%
filter(Position == "WR" |
Position == "RB" |
Position == "TE")
dst_bf <- data %>%
filter(Position == "DST")
#Lineup
# 1 QB, 2 RB, 3 WR, TE, FLEX, DST
#Brute force
team_frame <- data.frame()
track <- data.frame()
for(i in 1:500){
QB <- sample_n(qb_bf, 1, replace = FALSE)
RB <- sample_n(rb_bf, 2, replace = FALSE)
WR <- sample_n(wr_bf, 3, replace = FALSE)
TE <- sample_n(te_bf, 1, replace = FALSE)
FLEX <- sample_n(flex_bf, 1, replace = FALSE)
DST <- sample_n(dst_bf, 1, replace = FALSE)
new_team <- rbind(QB, RB, WR, TE, FLEX, DST)
new_team <- new_team %>%
mutate(team_num = i) %>%
group_by(team_num) %>%
mutate(Tot_Salary = sum(Salary, na.rm = TRUE),
Tot_Points = sum(points, na.rm = TRUE),
Max_Points = sum(upper, na.rm = TRUE),
Min_Points = sum(lower, na.rm = TRUE),
Risk = sum(risk, na.rm = TRUE)) %>%
ungroup()
for(j in 1:6000) {
temp_team <- new_team
position <- sample(1:9, 1)
if(position == 1){
new_player = sample_n(qb_bf, 1, replace = FALSE)
} else if(position > 1 & position < 4) {
new_player = sample_n(rb_bf, 1, replace = FALSE)
} else if(position > 3 & position < 7){
new_player = sample_n(wr_bf, 1, replace = FALSE)
} else if(position == 7){
new_player = sample_n(te_bf, 1, replace = FALSE)
} else if(position == 8){
new_player = sample_n(flex_bf, 1, replace = FALSE)
} else if(position == 9){
new_player = sample_n(dst_bf, 1, replace = FALSE)
}
new_player <- new_player %>%
mutate(team_num = i,
Tot_Salary = 0,
Tot_Points = 0)
temp_team[position, ] <- new_player[1, ]
temp_team <- temp_team %>%
group_by(team_num) %>%
mutate(Tot_Salary = sum(Salary, na.rm = TRUE),
Tot_Points = sum(points, na.rm = TRUE),
Max_Points = sum(upper, na.rm = TRUE),
Min_Points = sum(lower, na.rm = TRUE),
Risk = sum(risk, na.rm = TRUE))  %>%
ungroup()
if(n_distinct(temp_team$plr_team) == 9 &
temp_team$Tot_Salary[1] <= 50000 &
temp_team$Tot_Points[1] > new_team$Tot_Points[1]){
new_team <- temp_team
} else
new_team <- new_team
#track_row <- as.data.frame(cbind(new_team$team_num[1], j, new_team$Tot_Points[1], new_team$Tot_Salary[1]))
#track <- bind_rows(track, track_row)
}
team_frame <- bind_rows(team_frame, new_team)
temp_max <-  max(team_frame$Tot_Points)
#print(c(i, temp_max))
}
#Lineup
# 1 QB, 2 RB, 3 WR, TE, FLEX, DST
#Brute force
team_frame <- data.frame()
track <- data.frame()
for(i in 1:500){
QB <- sample_n(qb_bf, 1, replace = FALSE)
RB <- sample_n(rb_bf, 2, replace = FALSE)
WR <- sample_n(wr_bf, 3, replace = FALSE)
TE <- sample_n(te_bf, 1, replace = FALSE)
FLEX <- sample_n(flex_bf, 1, replace = FALSE)
DST <- sample_n(dst_bf, 1, replace = FALSE)
new_team <- rbind(QB, RB, WR, TE, FLEX, DST)
new_team <- new_team %>%
mutate(team_num = i) %>%
group_by(team_num) %>%
mutate(Tot_Salary = sum(Salary, na.rm = TRUE),
Tot_Points = sum(points, na.rm = TRUE),
Max_Points = sum(upper, na.rm = TRUE),
Min_Points = sum(lower, na.rm = TRUE),
Risk = sum(risk, na.rm = TRUE)) %>%
ungroup()
for(j in 1:6000) {
temp_team <- new_team
position <- sample(1:9, 1)
if(position == 1){
new_player = sample_n(qb_bf, 1, replace = FALSE)
} else if(position > 1 & position < 4) {
new_player = sample_n(rb_bf, 1, replace = FALSE)
} else if(position > 3 & position < 7){
new_player = sample_n(wr_bf, 1, replace = FALSE)
} else if(position == 7){
new_player = sample_n(te_bf, 1, replace = FALSE)
} else if(position == 8){
new_player = sample_n(flex_bf, 1, replace = FALSE)
} else if(position == 9){
new_player = sample_n(dst_bf, 1, replace = FALSE)
}
new_player <- new_player %>%
mutate(team_num = i,
Tot_Salary = 0,
Tot_Points = 0)
temp_team[position, ] <- new_player[1, ]
temp_team <- temp_team %>%
group_by(team_num) %>%
mutate(Tot_Salary = sum(Salary, na.rm = TRUE),
Tot_Points = sum(points, na.rm = TRUE),
Max_Points = sum(upper, na.rm = TRUE),
Min_Points = sum(lower, na.rm = TRUE),
Risk = sum(risk, na.rm = TRUE))  %>%
ungroup()
if(n_distinct(temp_team$plr_team) == 9 &
temp_team$Tot_Salary[1] <= 50000 &
temp_team$Tot_Points[1] > new_team$Tot_Points[1]){
new_team <- temp_team
} else
new_team <- new_team
track_row <- as.data.frame(cbind(new_team$team_num[1], j, new_team$Tot_Points[1], new_team$Tot_Salary[1]))
track <- bind_rows(track, track_row)
}
team_frame <- bind_rows(team_frame, new_team)
temp_max <-  max(team_frame$Tot_Points)
print(c(i, temp_max))
}
library("ggplot2")
library("dplyr")
library("tidyr")
library("knitr")
library("tableone")
library("forcats")
library("survival")
library("npsurv")
library("broom")
library("tibble")
library("readr")
library("stringr")
library("redcapAPI")
options(width = 120)
rcon <- redcapConnection(url = 'https://redcap.med.upenn.edu/api/',
token = 'C4DC02D22F24621D2B38B8FC23FE5971')
dat <- exportRecords(rcon, labels = FALSE)
demo <- dat %>%
select(mrn, dob) %>%
filter(is.na(dob) == FALSE)
ci_eval <- dat %>%
select(mrn, ci_eval_date:hint_5_test_percent_avg_r) %>%
filter(is.na(ci_eval_date) == FALSE) %>%
select(mrn, ci_eval_date, date_type, test_ear, azbio_q_test_percent,
azbio_10_test_percent, azbio_5_test_percent, cnc_w_test_percent,
cnc_p_test_percent, hint_q_test_percent_avg, hint_10_test_percent_avg,
hint_5_test_percent_avg, qsin_avg_loss)
data <- inner_join(demo, ci_eval, by = "mrn") %>%
mutate(age_cand = round(as.numeric(difftime(ci_eval_date,
dob,
units = "days")/365.25), 2)) %>%
mutate(age_cand_f = cut(age_cand,
c(0, 20, 30, 40, 50, 60, 70, 80, 90, 100))) %>%
unique()
ear <- data %>%
filter(date_type == "Three Month") %>%
select(mrn, test_ear) %>%
group_by(mrn) %>%
mutate(num_ear = n_distinct(test_ear)) %>%
ungroup() %>%
unique() %>%
filter(num_ear == 1) %>%
select(mrn, test_ear)
data <- inner_join(ear, data, by = c("mrn", "test_ear")) %>%
gather(test, score, azbio_q_test_percent:qsin_avg_loss) %>%
filter(score <= 100)
# data %>%
#   filter(date_type == "Candidacy" |
#            date_type == "One Month" |
#            date_type == "Three Month" |
#            date_type == "Six Months" |
#            date_type == "One Year") %>%
#   mutate(date_type = factor(date_type)) %>%
#   ggplot(aes(x = date_type, y = score, color = age_cand_f)) +
#   geom_boxplot() +
#   facet_wrap(~test, ncol = 1)
data %>%
filter(date_type == "Candidacy" |
date_type == "One Month" |
date_type == "Three Month" |
date_type == "Six Months" |
date_type == "One Year") %>%
mutate(date_type = factor(date_type)) %>%
filter(test == "azbio_q_test_percent") %>%
rename(Age = age_cand_f) %>%
ggplot(aes(x = date_type, y = score, color = Age)) +
geom_boxplot() +
theme(legend.position = "top") +
xlab("Test Date Type") +
ylab("Score")
data %>%
filter(date_type == "Candidacy" |
date_type == "One Month" |
date_type == "Three Month" |
date_type == "Six Months" |
date_type == "One Year") %>%
mutate(date_type = factor(date_type)) %>%
filter(test == "azbio_q_test_percent") %>%
CreateTableOne(data = .,
vars = c("date_type"),
strata = c("age_cand_f"),
includeNA = TRUE) %>%
print(.,
showAllLevels = TRUE)
data %>%
filter(date_type == "Candidacy" |
date_type == "One Month" |
date_type == "Three Month" |
date_type == "Six Months" |
date_type == "One Year")  %>%
mutate(date_type = factor(date_type)) %>%
filter(test == "azbio_q_test_percent") %>%
group_by(date_type, age_cand_f) %>%
summarise(group_med = median(score, na.rm = TRUE))
data %>%
filter(date_type == "Candidacy" |
date_type == "One Month" |
date_type == "Three Month" |
date_type == "Six Months" |
date_type == "One Year") %>%
mutate(date_type = factor(date_type)) %>%
filter(test == "azbio_10_test_percent") %>%
rename(Age = age_cand_f) %>%
ggplot(aes(x = date_type, y = score, color = Age)) +
geom_boxplot() +
theme(legend.position = "top") +
xlab("Test Date Type") +
ylab("Score")
data %>%
filter(date_type == "Candidacy" |
date_type == "One Month" |
date_type == "Three Month" |
date_type == "Six Months" |
date_type == "One Year") %>%
mutate(date_type = factor(date_type)) %>%
filter(test == "azbio_10_test_percent") %>%
CreateTableOne(data = .,
vars = c("date_type"),
strata = c("age_cand_f"),
includeNA = TRUE) %>%
print(.,
showAllLevels = TRUE)
data %>%
filter(date_type == "Candidacy" |
date_type == "One Month" |
date_type == "Three Month" |
date_type == "Six Months" |
date_type == "One Year")  %>%
mutate(date_type = factor(date_type)) %>%
filter(test == "azbio_10_test_percent") %>%
group_by(date_type, age_cand_f) %>%
summarise(group_med = median(score, na.rm = TRUE))
data %>%
filter(date_type == "Candidacy" |
date_type == "One Month" |
date_type == "Three Month" |
date_type == "Six Months" |
date_type == "One Year") %>%
mutate(date_type = factor(date_type)) %>%
filter(test == "azbio_5_test_percent") %>%
rename(Age = age_cand_f) %>%
ggplot(aes(x = date_type, y = score, color = Age)) +
geom_boxplot() +
theme(legend.position = "top") +
xlab("Test Date Type") +
ylab("Score")
data %>%
filter(date_type == "Candidacy" |
date_type == "One Month" |
date_type == "Three Month" |
date_type == "Six Months" |
date_type == "One Year") %>%
mutate(date_type = factor(date_type)) %>%
filter(test == "azbio_5_test_percent") %>%
CreateTableOne(data = .,
vars = c("date_type"),
strata = c("age_cand_f"),
includeNA = TRUE) %>%
print(.,
showAllLevels = TRUE)
data %>%
filter(date_type == "Candidacy" |
date_type == "One Month" |
date_type == "Three Month" |
date_type == "Six Months" |
date_type == "One Year")  %>%
mutate(date_type = factor(date_type)) %>%
filter(test == "azbio_5_test_percent") %>%
group_by(date_type, age_cand_f) %>%
summarise(group_med = median(score, na.rm = TRUE))
data %>%
filter(date_type == "Candidacy" |
date_type == "One Month" |
date_type == "Three Month" |
date_type == "Six Months" |
date_type == "One Year") %>%
mutate(date_type = factor(date_type)) %>%
filter(test == "cnc_w_test_percent") %>%
rename(Age = age_cand_f) %>%
ggplot(aes(x = date_type, y = score, color = Age)) +
geom_boxplot() +
theme(legend.position = "top") +
xlab("Test Date Type") +
ylab("Score")
data %>%
filter(date_type == "Candidacy" |
date_type == "One Month" |
date_type == "Three Month" |
date_type == "Six Months" |
date_type == "One Year") %>%
mutate(date_type = factor(date_type)) %>%
filter(test == "cnc_w_test_percent") %>%
CreateTableOne(data = .,
vars = c("date_type"),
strata = c("age_cand_f"),
includeNA = TRUE) %>%
print(.,
showAllLevels = TRUE)
data %>%
filter(date_type == "Candidacy" |
date_type == "One Month" |
date_type == "Three Month" |
date_type == "Six Months" |
date_type == "One Year")  %>%
mutate(date_type = factor(date_type)) %>%
filter(test == "cnc_w_test_percent") %>%
group_by(date_type, age_cand_f) %>%
summarise(group_med = median(score, na.rm = TRUE))
data %>%
filter(date_type == "Candidacy" |
date_type == "One Month" |
date_type == "Three Month" |
date_type == "Six Months" |
date_type == "One Year") %>%
mutate(date_type = factor(date_type)) %>%
filter(test == "cnc_p_test_percent") %>%
rename(Age = age_cand_f) %>%
ggplot(aes(x = date_type, y = score, color = Age)) +
geom_boxplot() +
theme(legend.position = "top") +
xlab("Test Date Type") +
ylab("Score")
# data %>%
#   filter(date_type == "Candidacy" |
#            date_type == "One Month" |
#            date_type == "Three Month" |
#            date_type == "Six Months" |
#            date_type == "One Year") %>%
#   mutate(date_type = factor(date_type)) %>%
#   filter(test == "cnc_p_test_percent") %>%
#   CreateTableOne(data = .,
#                  vars = c("date_type"),
#                  strata = c("age_cand_f"),
#                  includeNA = TRUE) %>%
#   print(.,
#         showAllLevels = TRUE)
# data %>%
#   filter(date_type == "Candidacy" |
#            date_type == "One Month" |
#            date_type == "Three Month" |
#            date_type == "Six Months" |
#            date_type == "One Year")  %>%
#   mutate(date_type = factor(date_type)) %>%
#   filter(test == "cnc_p_test_percent") %>%
#   group_by(date_type, age_cand_f) %>%
#   summarise(group_med = median(score, na.rm = TRUE))
data %>%
filter(date_type == "Candidacy" |
date_type == "One Month" |
date_type == "Three Month" |
date_type == "Six Months" |
date_type == "One Year") %>%
mutate(date_type = factor(date_type)) %>%
filter(test == "hint_q_test_percent_avg") %>%
rename(Age = age_cand_f) %>%
ggplot(aes(x = date_type, y = score, color = Age)) +
geom_boxplot() +
theme(legend.position = "top") +
xlab("Test Date Type") +
ylab("Score")
# data %>%
#   filter(date_type == "Candidacy" |
#            date_type == "One Month" |
#            date_type == "Three Month" |
#            date_type == "Six Months" |
#            date_type == "One Year") %>%
#   mutate(date_type = factor(date_type)) %>%
#   filter(test == "hint_q_test_percent_avg") %>%
#   CreateTableOne(data = .,
#                  vars = c("date_type"),
#                  strata = c("age_cand_f"),
#                  includeNA = TRUE) %>%
#   print(.,
#         showAllLevels = TRUE)
# data %>%
#   filter(date_type == "Candidacy" |
#            date_type == "One Month" |
#            date_type == "Three Month" |
#            date_type == "Six Months" |
#            date_type == "One Year")  %>%
#   mutate(date_type = factor(date_type)) %>%
#   filter(test == "hint_q_test_percent_avg") %>%
#   group_by(date_type, age_cand_f) %>%
#   summarise(group_med = median(score, na.rm = TRUE))
data %>%
filter(date_type == "Candidacy" |
date_type == "One Month" |
date_type == "Three Month" |
date_type == "Six Months" |
date_type == "One Year") %>%
mutate(date_type = factor(date_type)) %>%
filter(test == "hint_10_test_percent_avg") %>%
rename(Age = age_cand_f) %>%
ggplot(aes(x = date_type, y = score, color = Age)) +
geom_boxplot() +
theme(legend.position = "top") +
xlab("Test Date Type") +
ylab("Score")
# data %>%
#   filter(date_type == "Candidacy" |
#            date_type == "One Month" |
#            date_type == "Three Month" |
#            date_type == "Six Months" |
#            date_type == "One Year") %>%
#   mutate(date_type = factor(date_type)) %>%
#   filter(test == "hint_10_test_percent_avg") %>%
#   CreateTableOne(data = .,
#                  vars = c("date_type"),
#                  strata = c("age_cand_f"),
#                  includeNA = TRUE) %>%
#   print(.,
#         showAllLevels = TRUE)
# data %>%
#   filter(date_type == "Candidacy" |
#            date_type == "One Month" |
#            date_type == "Three Month" |
#            date_type == "Six Months" |
#            date_type == "One Year")  %>%
#   mutate(date_type = factor(date_type)) %>%
#   filter(test == "hint_10_test_percent_avg") %>%
#   group_by(date_type, age_cand_f) %>%
#   summarise(group_med = median(score, na.rm = TRUE))
data %>%
filter(date_type == "Candidacy" |
date_type == "One Month" |
date_type == "Three Month" |
date_type == "Six Months" |
date_type == "One Year") %>%
mutate(date_type = factor(date_type)) %>%
filter(test == "hint_5_test_percent_avg") %>%
rename(Age = age_cand_f) %>%
ggplot(aes(x = date_type, y = score, color = Age)) +
geom_boxplot() +
theme(legend.position = "top") +
xlab("Test Date Type") +
ylab("Score")
# data %>%
#   filter(date_type == "Candidacy" |
#            date_type == "One Month" |
#            date_type == "Three Month" |
#            date_type == "Six Months" |
#            date_type == "One Year") %>%
#   mutate(date_type = factor(date_type)) %>%
#   filter(test == "hint_5_test_percent_avg") %>%
#   CreateTableOne(data = .,
#                  vars = c("date_type"),
#                  strata = c("age_cand_f"),
#                  includeNA = TRUE) %>%
#   print(.,
#         showAllLevels = TRUE)
# data %>%
#   filter(date_type == "Candidacy" |
#            date_type == "One Month" |
#            date_type == "Three Month" |
#            date_type == "Six Months" |
#            date_type == "One Year")  %>%
#   mutate(date_type = factor(date_type)) %>%
#   filter(test == "hint_5_test_percent_avg") %>%
#   group_by(date_type, age_cand_f) %>%
#   summarise(group_med = median(score, na.rm = TRUE))
print(sessionInfo())
source('I:/Brant/Research/Website/build_site.R', echo=TRUE)
